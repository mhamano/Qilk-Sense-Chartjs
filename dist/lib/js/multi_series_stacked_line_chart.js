var visualize=function(e,t,a,o){var l=t.qInfo.qId+"_chartjs_stacked_bar",i=o.calculateMargin(e,t),s=i[0],n=i[1];e.html('<canvas id="'+l+'" width="'+s+'" height="'+n+'"></canvas>');var r=[];r="auto"==t.colors?o.defineColorPalette(t.color_selection):t.custom_colors.split("-");var c=t.qHyperCube.qDataPages[0].qMatrix,d=o.flattenData(c),u=d[0],b=d[1],m=d[2];t.sort&&b.sort();var p=_.groupBy(u,"dim1"),h=[];h.dim1=[],h.dim1_elem=[],h=o.initializeArrayWithZero(_.size(p),b,h),h=o.storeHypercubeDataToArray(p,h),t.cumulative&&(h=o.addCumulativeValuesOnTwoDimensions(b,h));for(var v=[],g=0;g<b.length;g++){var y=[],k=g;"auto"==t.colors&&"twelve"==t.color_selection?k=g%12:"auto"==t.colors&&"one-handred"==t.color_selection?k=g%100:"custom"==t.colors&&(k=g%r.length),y.label=b[g],y.backgroundColor="rgba("+r[k]+","+t.opacity+")",y.data=h[b[g]],y.fill=t.background_color_switch,y.borderColor="rgba("+r[k]+","+t.opacity+")",y.pointBackgroundColor="#FFFFFF",y.pointRadius=t.point_radius_size,v.push(y)}var f={labels:h.dim1,datasets:v},q=document.getElementById(l);new Chart(q,{type:"line",data:f,options:{title:{display:t.title_switch,text:t.title},legend:{display:"hide"!=t.legend_position,position:t.legend_position,onClick:function(e,t){var o=[],l=1;m[t.text]<0||(o.push(m[t.text]),a.selectValues(l,o,!0))}},scales:{xAxes:[{stacked:!0,scaleLabel:{display:t.datalabel_switch,labelString:t.qHyperCube.qDimensionInfo[0].qFallbackTitle}}],yAxes:[{stacked:!0,scaleLabel:{display:t.datalabel_switch,labelString:t.qHyperCube.qMeasureInfo[0].qFallbackTitle},ticks:{beginAtZero:!0,callback:function(e,a,l){return o.formatMeasure(e,t,0)}}}]},tooltips:{mode:"label",callbacks:{label:function(e,a){return a.datasets[e.datasetIndex].label+": "+o.formatMeasure(e.yLabel,t,0)}}},responsive:!0,events:["mousemove","mouseout","click","touchstart","touchmove","touchend"],onClick:function(e){var t=this.getElementsAtEvent(e);t.length>0&&o.makeSelectionsOnDataPoints(h.dim1_elem[t[0]._index],a)}}})};